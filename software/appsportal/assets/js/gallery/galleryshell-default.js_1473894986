function debug(){}function genGalleryModel(t,e){function a(t){this.startN=0,this.numN=gcfg.numN,this.maxN=0,this.sedata=null,this.query="",this.mdf={},this.tier=getTier(window.location.hostname),this.display=1,this.clearAll=!1,this.col="All",this.type="All",this.subCat=0,this.init=function(e){this._initMDF(t),e&&this.updateByHash(e)},this._initMDF=function(t){for(var e=t.length,i=null;e--;){var i=t[e].split(":");this.clearAll&&$("#preFilter")&&$("#preFilter").val()==i[0]?this.clearAll=!1:this.mdf[i[0]]={len:parseInt(i[1],10),state:"",value:""}}},this.clearMDF=function(){this.clearAll=!0,this._initMDF(gcfg.mdfL)},this.genViewData=function(){var t={hash:this._genHash()};return this.displayDescription(this.mdf),t},this.displayDescription=function(t){function e(t){var e=t.split("-");for(i=0;i<e.length;i++){var a=e[i].substring(1).toLowerCase();e[i]=e[i][0].toUpperCase()+a}return e=e.join(" ")}function a(t){return"root-pages"==t?"All Industries":e(t)}var n=t.industries.value||"root-pages";industry_parts=n.split(":");var s=gcfg.customInfo,r=null;if(industry_parts[0]in s){for(var l=0;l<industry_parts.length;l++)s=s[industry_parts[l]];if(r=s.description||null,null!=r){var o=$("#gl-description"),h=a(industry_parts[0]);if(o.length>0)$(o>"span").innerHTML=r,$(o>"h2").innerHTML=h;else{var u=document.createElement("div"),d=document.createElement("h2"),c=$("<span>"+r+"</span>")[0],p=document.createElement("span"),h=document.createTextNode(h),f=document.createTextNode("Â "),g=document.createElement("hr"),m=$("#gl-content");u.setAttribute("id","gl-description"),d.appendChild(h),p.appendChild(c),u.appendChild(d),u.appendChild(p),m.prepend(g),m.prepend(u),m.prepend(f)}}}},this.genAJaxParamData=function(){var t={ajaxData:this._genAjaxData()};return t},this.updateSEData=function(t){this.sedata=t,this.startN=t.startI-1,this.maxN=t.estN},this.updateByHash=function(t){var e=this._parseHash(t);e.s?(this.startN=parseInt(e.s,10),isNaN(this.startN)&&(this.startN=0)):this.startN=0,e.n?(this.numN=parseInt(e.n,10),isNaN(this.numN)&&(this.numN=gcfg.numN)):this.numN=gcfg.numN,this.query=e.q?decodeURIComponent(e.q):"",this.col=e.col?decodeURIComponent(e.col):"",this.type=e.type?decodeURIComponent(e.type):"All",e.md?this._setMdf(e.md):this._initMDF(gcfg.mdfL),this.subCat=e.subCat?e.subCat:0,e.d?(this.display=parseInt(e.d,10),isNaN(this.display)&&(this.display=gcfg.displayType)):this.display=gcfg.displayType},this.updateByFilter=function(){for(var t in this.mdf)if(this.mdf.hasOwnProperty(t)){for(var e=[],i=0,a=1,n=1+this.mdf[t].len;n>a;a++)if($("#filters #"+t+"-"+a).hasClass("current")){i+=1;var s=$("#filters #"+t+"-"+a).attr("value").split(":")[1],r=$("#filters #"+t+"-"+a).attr("value").split(":")[2]||"";r.length>0&&(r=":"+r),e.push(s+r)}else e.push("");this.mdf[t].value=i>0?e.join(""):""}this.startN=0},this.updateQuery=function(){this.query=$.trim($("#query").val()),this.startN=0},this.updateCollection=function(t){this.col=t;var e=t.split(":"),a=this.mdf;for(var n in this.mdf)if(n==e[0]){if(2===e.length){var s=[];for(i=1;i<=e[1];i++)s.push("1");a[e[0]].state=s.join("")}}else a[n].state=""},this.updateSubCat=function(t){this.subCat=t},this.updateType=function(t){this.type=t},this.updateDisplayN=function(t){var e=Math.max(1,t);e=Math.min(3,e),gcfg.cntL=gcfg.cntL||[15,30,45],this.numN=1===e?gcfg.cntL[0]:2===e?gcfg.cntL[1]:3===e?gcfg.cntL[2]:gcfg.cntL[1],this.startN=0},this.updateDisplay=function(t){this.display=Math.max(1,t),this.display=Math.min(3,this.display)},this.gotoPage=function(t){t=(t-1)*this.numN,t=Math.min(this.maxN,t),this.startN=Math.max(0,t)},this.inc=function(){this.startN=Math.min(this.maxN,this.startN+this.numN+1)},this.dec=function(){this.startN=Math.max(0,this.startN-this.numN)},this.updatePagination=function(t){this.startN=t||0},this._setMdf=function(t){this._initMDF(gcfg.mdfL);var e=this.mdf;$.each(t.split("_"),function(t,i){var a=i.split(":");(2===a.length||3===a.length)&&e.hasOwnProperty(a[0])&&(e[a[0]].state=a[1],e[a[0]].value=i.split(a[0]+":")[1])}),this.startN=0},this._parseHash=function(t){var e={};if(t=$.trim(t.substr(1)),$.each(t.split("&"),function(t,i){var a=i.split("=");e[a[0]]=2===a.length?a[1]:""}),"md"in e)for(var i=e.md.split("_"),a=0;a<i.length;a++)i[a].split(":")[0]===gcfg.mainFilter&&(e.type=i[a].split(":").length<=1?"":i[a].split(":")[1]);else e.type="";return e},this._genHash=function(){function t(t){var e=[];for(key in t)t.hasOwnProperty(key)&&t[key].value&&e.push(key+":"+t[key].value);return e.join("_")}var e=[];e.push("s="+this.startN),this.query&&e.push("q="+encodeURIComponent(this.query));var i=t(this.mdf);return i&&e.push("md="+i),e.join("&")},this._genAjaxData=function(){function t(t){var e=[];for(key in t)if(t.hasOwnProperty(key)){var i=t[key].value;if(i){var a=gcfg.hierarchy?gcfg.hierarchy[i]:void 0,n=[];void 0!==a?$.each(a.split("|"),function(t,e){n.push(key+":"+e)}):n.push(key+":"+i),n.length&&e.push("("+n.join("|")+")")}}return e.join(".")}function e(t){if(ids={"local-government":"6abf8abeb3e4436eb4ae0053be3fcbe0,","state-government":"854bb4bdb67544539f611e381e9662a9,","parks-gardens":"ed24c65fad2b4a1d84c9d5cbf6c3e28a,",water:"7e3149a52e46416f94c1c56df3a7918b,",gas:"1d326b28ac734aaabc4903d71d3f44ae,",electric:"20a3c2d8d5cc4e0493220fa06ea0e979,",telecommunications:"2add18dcc8594ca695a8821993a41cb3,","emergency-management":"206467c739634a4b84dd3cbeb9dfab49,",defense:"27d6acb2d761418e94faa29b43b44f6f,"},"All"==t||""==t)var e=Object.keys(ids).reduce(function(t,e){return t.concat(ids[e])},"");else var e=ids[t];var i=[];return e?($.each(e.split(","),function(t,e){/\S/.test(e)&&i.push('group:"'+e+'"')}),i.join(" OR ")):""}function i(t){return tagsL=[],l=[],partial_list=t.split("."),partial_list.forEach(function(t){partial=t.replace("(","").replace(")",""),tag_list=partial.split(":"),tag_list[0]==gcfg.mainFilter&&tag_list.shift(),tag_list.shift(),tag_list.forEach(function(t){t&&tagsL.push('tags:"'+t+'"')})}),tagsL&&l.push("("+tagsL.join(" AND ")+")"),l.join(".")}var a=[],n=[];a.push("f=json"),a.push("sortField=modified"),a.push("sortOrder=desc"),a.push("start="+this.startN),a.push("num="+this.numN),this.query&&n.push(encodeURIComponent(this.query));var s=e(this.type);n.push("("+s+")");var r=t(this.mdf),l=i(r);return l.length>2&&n.push(l),a.join("&")+"&q="+n.join(" ")}}var n=new a(e);return n.init(t),n}function SEData(t){this.estN="undefined"==typeof t?0:parseInt(t.total),this.startI="undefined"==typeof t?0:parseInt(t.start),this.endI="undefined"==typeof t?0:parseInt(t.num),this.rowL="undefined"==typeof t.results?[]:t.results instanceof Array?t.results:[t.results],this.query=t.query}function SERow(t){this.data=t,this._md=function(t){var e={};if(t)for(var i=t.length,a=null;i--;)a=t[i],e[a["@n"]]=a["@v"];return e}(t.mt)}function createGalleryShell(){var t={gm:null,display:null,pageNav:null,reloadCount:0,featureddata:null,numberofRegularItemsRequires:0,init:function(t){t.query&&$("#query").val(t.query),this._updateSingleSelectionFilter(t)},updateHash:function(t,e){var i=e||t.genViewData();i.hash&&(window.location.hash=i.hash)},update:function(t){this.gm=t;var e=t.genViewData(),i=t.genAJaxParamData();t.query&&$("#query").val(t.query),this.updateHash(t,e),this._updateSingleSelectionFilter(t),$.ajax({url:t.tier.agolHost+"sharing/rest/search",dataType:"jsonp",context:this,data:i.ajaxData,timeout:1e4,beforeSend:function(){$("#spinner").show()},success:function(e){$("#spinner").hide(),this._updateModelAndView(e),this.reloadCount+=1,t.queryStatus="completed"},error:function(){$("#gl-content").html(gcfg.errorMsg),$("#spinner").hide()}})},_updateSingleSelectionFilter:function(t){var e=t.mdf,i=0,a=0;totalItemSelected=0;for(var n in e){if(e.hasOwnProperty(n))for(var s=e[n].value,r=0,i=1,a=1+e[n].len;a>i;i++){var l="#filters #"+n+"-"+i;if($(l).attr("value")==n+":"+s){$(l).addClass("current"),r+=1,totalItemSelected++;var o=$(l).attr("value").split(":");o.length>2&&o[0]==gcfg.mainFilter&&(parent=$("label[id][value='"+o[0]+":"+o[1]+"'][class*='parent-filter']"),this.showChildFilters(parent))}else $(l).removeClass("current")}r>=1?($("."+n+"-filter .reset-filter").css("display","block"),$("#allCollections").removeClass("current")):$("."+n+"-filter .reset-filter").css("display","none")}0>=totalItemSelected&&$(".All-filter").addClass("current")},refreshChildFilters:function(){for(var t=$(".parent-filter"),e=0;e<t.length;e++){var i=$(t[e]).attr("value");if(i.split(":")[0]==gcfg.mainFilter){var a=$("label[id][value*='"+i+":'][class*='child-filter']");a.length>0&&(a.css("display","none"),$(t[e]).removeClass("triangleExpanded"),$(t[e]).addClass("triangleCollapsed"))}}},hideChildFilters:function(t){var e=$(t).attr("value"),i=$("label[id][value*='"+e+":'][class*='child-filter']");i.css("display","none"),$(t).removeClass("triangleExpanded"),$(t).addClass("triangleCollapsed")},showChildFilters:function(t){var e=$(t).attr("value"),i=$("label[id][value*='"+e+":'][class*='child-filter']");i.css("display","block"),$(t).removeClass("triangleCollapsed"),$(t).addClass("triangleExpanded")},toggleChildFilters:function(t){var e=$(t).attr("value"),i=$("label[id][value*='"+e+":'][class*='child-filter']");"none"!=i.css("display")?this.hideChildFilters(t):this.showChildFilters(t)},updateDisplay:function(){this.display&&this.display.update(this.gm)},_updateModelAndView:function(t){var e=new SEData(t);this.gm.updateSEData(e),null===this.display&&(this.display=genDisplay()),this.display.update(this.gm),null===this.pageNav&&(this.pageNav=genPageNav()),this.pageNav.update(this.gm)}};return t}SEData.prototype.getRow=function(t){return new SERow(this.rowL[t])},SERow.prototype.md=function(t,e){return(this._md.hasOwnProperty(t)?this._md[t]:e)||e},SERow.prototype.val=function(t,e){return this.data.hasOwnProperty(t)?this.data[t]:e},SERow.prototype.agolId=function(){return this.data.id},SERow.prototype.agolItemType=function(){var t=this.data.type||"None";return"None"!==t&&(t=t.match(/application/ig)?"app":"map"),t},SERow.prototype.agolItemUrl=function(t){var e=(this.agolItemType(),gcfg.host||"http://www.arcgis.com");return e+"/home/item.html?id="+t},SERow.prototype.agolImgUrl=function(t){var e=this.data.largeThumbnail&&""!=this.data.largeThumbnail?this.data.largeThumbnail:this.data.thumbnail,i=gcfg.emptyImgUrl,a=getTier(window.location.hostname).agolHost||"http://www.arcgis.com";return"None"!==e&&(i=a+"/sharing/content/items/"+t+"/info/"+e),i},SERow.prototype.contentCreator=function(t){for(var e=t.length,i=0;e>i;i++)if(split_tag=t[i].split(":"),"Creator"==$.trim(split_tag[0]))return $.trim(split_tag[1])},SERow.prototype.agolContent=function(t){function e(t,e){for(var i=0;i<t.length;i++){var a=e.match(t[i]);if(null!=a)return!0}return!1}var i=this.data.description,a="";null!=this.data.snippet?a=this.data.snippet:null!=this.data.type&&(a=this.data.type);var n=$("<div>"+i+"</div>"),s=["Online Help","online help","Online help","online Help"];try{for(var r=0;r<s.length;r++){var l=n.find("a:contains('"+s[r]+"')");if(l.length>0)break}var o=l.attr("href")||t}catch(h){var o=t}var u="",d=["www.arcgis.com","solutions.arcgis.com",/&downloadid=[0-9]{4}$/];if("Desktop Application Template"!=this.data.type&&(u=this.data.url||""),e(d,u)&&(u=""),"undefined"==typeof u||""===u)for(var c=["Try It Now","Try it Now"],p=0;p<c.length;p++){var l=n.find("a:contains('"+c[p]+"')");if("undefined"!=typeof l&&(u=l.attr("href")),"undefined"!=typeof u&&""!==u)break;var f=n.find("*:contains('"+c[p]+"')");if("undefined"!=typeof f)for(var g=2,m=f,y="",v=0;g>v;v++)if(m=m.next(),y=m.find("a"),y.length>0){if(u=y.attr("href"),!e(d,u))break;u=""}}return[o,a,u]},$(document).ready(function(){function t(t){return $("#query").val(""),$("#gl-cl-btn").hide(),$("#gl-content").empty(),$("#spinner").show(),i.reloadCount>=1&&(e.updateQuery(),i.update(e),i.reloadCount=0,t.stopImmediatePropagation()),!1}var e=null,i=createGalleryShell(),a=gcfg.mdfL;i.refreshChildFilters(),$("#query").bind({keydown:function(t){return"13"==t.keyCode?($("#gl-content").empty(),$("#spinner").show(),e.updateQuery(),i.update(e),t.stopImmediatePropagation(),!1):void 0},input:function(){$(this).val().length<=0&&($("#gl-cl-btn").hide(),$("#gl-content").empty(),$("#spinner").show(),e.updateQuery(),i.update(e))},focus:function(){$(this).val()==$(this)[0].defaultValue&&$(this).val("")},keyup:function(){var t=$(this).val();t.trim()?$("#gl-cl-btn").show():$("#gl-cl-btn").hide()}}),$("#filters .ctrlbox label").bind("click",function(){$("#gl-content").empty(),$("#spinner").show();var t=$(this),a=$(t).attr("value"),n=a.split(":")[0],s=a.split(":")[1],r=$("label[id][value*='"+a+":'][class*='child-filter']");n==gcfg.mainFilter&&(e.updateType(s),r.length>0&&i.toggleChildFilters(t)),$(".sub-filter-"+n).each(function(){$(this).removeClass("current")}),$(this).addClass("current"),$("."+n+"-filter .reset-filter").css("display","block"),$("#allCollections").removeClass("current"),e.updateByFilter($(this)),i.update(e)}),$(".reset-filter").bind("click",function(){i.refreshChildFilters();var t=$(this).parent(),a=$(t).attr("for"),n=$(t).attr("col").split(":")[0];n==gcfg.mainFilter&&e.updateType(""),$("#"+a+" label").each(function(){$(this).removeClass("current")}),$(this).hide(),$("#gl-content").empty(),e.updateByFilter(),i.update(e)}),$("#search, #gl-search-btn").bind("click",function(t){return $("#gl-content").empty(),$("#spinner").show(),e.updateQuery(),i.update(e),t.stopImmediatePropagation(),!1}),$("#display1, #display2, #display3").bind("click",function(t){return e.updateDisplay(parseInt(t.target.id.slice("display".length),10)),i.updateHash(e),i.updateDisplay(e),$("#display1, #display2, #display3").removeClass(),$("#"+t.target.id).addClass("displaytype_selected"),t.stopImmediatePropagation(),!1}),$("#gl-filter-clear").bind("click",function(a){return t(a),e.clearMDF(),i.update(e),a.stopImmediatePropagation(),!1}),$(".All-filter").bind("click",function(t){$("#gl-content").empty(),$("#spinner").show(),$("#filters label").each(function(){$(this).removeClass("current")}),$(this).addClass("current"),e.updateType("All"),e.updateSubCat(0),e.updateByFilter(),i.update(e),$(".reset-filter").css("display","none"),t.stopImmediatePropagation()}),$(".tablet-theme-dropDown").bind("click",function(){$("#navFilters").toggle("slow")}),$(window).scroll(function(){if($(document).height()<=$(window).scrollTop()+$(window).height()+300){{e.maxN}if(e.queryStatus&&"completed"==e.queryStatus&&e.sedata.rowL.length>=e.numN)return $(".more-spinner").css("display","block"),e.queryStatus=null,e.inc(),i.update(e),!1}}),window.onhashchange=function(){var t=window.location.hash;if(t){var a=e.genViewData();a.hash&&"#"+a.hash!==t&&($("#gl-content").empty(),e.updateByHash(t),i.update(e),e.query&&$("#gl-cl-btn").show())}};try{var n="#s=0&n="+gcfg.numN+"&filter=0";window.location.hash&&(n=window.location.hash),e=genGalleryModel(n,a),e.startN=0,i.init(e),i.update(e),e.query&&$("#gl-cl-btn").show()}catch(s){debug(s.message)}$("#gl-cl-btn").click(function(e){return t(e)})});